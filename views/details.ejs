<%- include('./partials/head.ejs')  %> 

<div>
    <h4><%= info.username  %> </h4>
    <h4><%= info.title %> </h4>
    <h4><%= info.post %> </h4>
    <h4><%= info.createdAt %> </h4>
</div>



<div>
    <h3>Comments</h3>
    
    <% if(info.comments.length > 0) { %> 
        <p><% info.comments.forEach(commentArray => { %> 
           Written By <%= commentArray.writtenBy  %> 
        </p>
        <p>
            Reply <%= commentArray.commentBody  %> 
         </p>
         
          <% }) %> 
        <% } else { %> 
            <p>This post has no comments</p>
            <% } %> 
</div>
<a class="delete" data-doc="<%= info._id %>">Delete</a>

<script>

var deleteEl = document.querySelector('a.delete');

deleteEl.addEventListener('click', (e) => {
    const endpoint = `/api/posts/${deleteEl.dataset.doc}`;

    fetch(endpoint, {
        method: 'DELETE',
    }).then(response => response.json()).then(data => window.location.href = data.redirect)
})

</script>