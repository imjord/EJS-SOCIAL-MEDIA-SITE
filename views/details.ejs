<%- include('./partials/head.ejs')  %> 

<div>
    <h4><%= info.username  %> </h4>
    <h4><%= info.title %> </h4>
    <h4><%= info.post %> </h4>
    <h4><%= info.createdAt %> </h4>
</div>



<div>
    <h3>Comments</h3>
    <form action="/api/comments/<%= info.id %>" method="POST">
        <label for="writtenBy">Written by:</label>
    <input type="text" id="writtenBy" name="writtenBy">
    <label for="commentBody">Comment:</label>
    <input type="text" id="commentBody" name="commentBody">
    <button>Submit</button>
    </form>
    
    <% if(info.comments.length > 0) { %> 
        <p><% info.comments.forEach(commentArray => { %> 
           Written By: <%= commentArray.writtenBy  %> 
        </p>
        <p>
            Comment: <%= commentArray.commentBody  %> 
         </p>
         
          <% }) %> 
        <% } else { %> 
            <p>This post has no comments</p>
            <% } %> 
</div>
<a class="delete" data-doc="<%= info._id %>">Delete</a>

<script>

var deleteEl = document.querySelector('a.delete');

deleteEl.addEventListener('click', (e) => {
    const endpoint = `/api/posts/${deleteEl.dataset.doc}`;

    fetch(endpoint, {
        method: 'DELETE',
    }).then(response => response.json()).then(data => window.location.href = data.redirect)
})

function handleSubmit(e) {
    e.preventDefault();
}

</script>